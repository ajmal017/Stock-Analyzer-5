<!DOCTYPE html>

<html lang="en">

<head>
    <title>Stock Analysis</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, shrink-to-fit=no">

    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'style_sa.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700,800,900|Inconsolata|Unica+One&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
    
    
</head>

<body>
    <div class="container-fluid">
            
        <!-- NAVBAR -->
        <nav class="navbar navbar-light navbar-expand-xl bg-light grey lighten-4 fixed-top justify-content-between">
            <div class="container-fluid" style="box-sizing: border-box;">
                <button class="navbar-toggler order-2" type="button" data-toggle="collapse" data-target=".dual-nav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="navbar-collapse collapse dual-nav w-50 order-3 order-xl-1">
                    <ul class="navbar-nav">
                        <li class="nav-item active">
                            <a class="nav-link" href="{% url 'Analyze:index' %}">Stock Data</a>
                        </li>
                    </ul>
                </div>

                <a href="{% url 'Analyze:index' %}" class="navbar-brand mx-auto d-block text-center order-1 order-xl-2 w-25">
                    <img src="{% static 'baker.jpg' %}" height="25px">
                </a>

                <div class="navbar-collapse collapse dual-nav w-50 order-3 order-xl-3">
                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                        </li>
                    </ul>
                </div>
            
            </div>
        </nav>

        <section id="about" style="">
            
            <div class="animation-container" id="file-upload">
                
            
                <!-- Download template -->
                <form action="{% url "Analyze:index" %}" method="get" enctype="multipart/form-data">
                    <h4>Download Template File</h4>
                    
                    {% load static %}
                    <a id="dl-button-temp" href="{% static 'holdings.xlsx' %}" style="text-decoration : none">Download Template</a>
                    <p>
                </form>
                <hr>

                <!-- Input IEX Key and upload template -->
                <form method="post" id="upload-form" enctype="multipart/form-data"">
                    <!-- action="{% url "Analyze:index" %}" method="post" enctype="multipart/form-data" -->
                    <h4>IEX Authorization Key</h4>

                    <input type="text"
                               title="Upload excel file"
                               id="iex-key"
                               name="iex-key"
                               required="required"
                               style="">
                               
                               
                    <h4>Upload Template File</h4>
                               
                    {% csrf_token %}
                    <label>Select Template File
                        <input type="file"
                               title="Upload excel file"
                               id="file-upload"
                               name="excel_file"
                               required="required"
                               style="display: none;">
                    </label> 
                    
                    <div id="file-upload-filename"></div>

                    <input type="submit" id="run-report" value="Run Stock Report" style="display: none;"/> 
                </form>
                <input type="button" id="submit-button" value="Run Stock Report"/>  
                <hr>
 
                
                <!-- Display loading/results after form submit -->
                <div id="loading-results" form-submitted="no" name="{{ data }}"> 
                    <h4>Loading ... </h4>
                </div>
                
                <div id="results" form-submitted="no" name="{{ data }}"> 
                    
                    <h4>Results</h4>

                    {% for key, value in excel_data_dict.items %}
                        <h6> {{ key|default_if_none:"No data to report. " }} </h6>
                        <table>                                
                            {% for key_part, value_part in value.items %}
                                <tr>
                                    <td colspan="3" style="border-right: 1px solid #F6F5F5"> {{ key_part }} </td>
                                    {% for val in value_part %}
                                        <td colspan="3"> {{ val }} </td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </table>
                        <br><br><br>
                    {% endfor %}
                    <br>
                        
                    <form action="{% url "Analyze:index" %}" method="get" enctype="multipart/form-data">
                        <a id="dl-button-final" href="{{ MEDIA_URL }}stock_data.xlsx" >Download File</a>
                    </form>
                    <hr>
                    
                </div>

           </div>
 
        </section>
    </div>
    
    
    
    <!-- SCRIPTS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    
    <!-- script to show file upload once selected -->
    <script>
        var input = document.getElementById( 'file-upload' );
        var infoArea = document.getElementById( 'file-upload-filename' );

        input.addEventListener( 'change', showFileName );
        
        function showFileName( event ) {
          
            var input = event.srcElement;
            
            var fileName = input.files[0].name;
            
            // use fileName however fits your app best, i.e. add it into a div
            infoArea.textContent = 'File name: ' + fileName;
        }
    </script>
       
    <!-- script to show/hide loading and results divs and appropriate times -->     
    <script>   
        $(document).ready(function(){
            if($('#results').attr('form-submitted') == "no" && $('#results').attr('name') == "hide") {
               $('#results').hide(); 
            }
            if($('#loading-results').attr('form-submitted') == "no" && $('#loading-results').attr('name') == "hide") {
               $('#loading-results').hide(); 
            }
            if($('#loading-results').attr('form-submitted') == "no" && $('#loading-results').attr('name') == "show") {
               $('#loading-results').hide(); 
            }
               
        });
        
        $(document).ready(function(){
            $("#submit-button").click(function(event){
                $("#loading-results").show();

                $("#upload-form").submit();
            });
        });

    </script>
</body>

</html>